#!/bin/bash

USERNAME=$1
PASSWORD=$2
APIKEY=$3

if [[ -z "${USERNAME}" ]]; then
    echo "Useage: create-user USERNAME <PASSWORD> <APIKEY>"
    exit -1
fi

if [[ -z "${PASSWORD}" ]]; then
    read -s -p "Password: " PASSWORD; echo
    read -s -p "Confirm Password: " PASSCONFIRM; echo

    if [[ "$PASSWORD" != "$PASSCONFIRM" ]]; then
        echo "Passwords do not match, exiting"
        exit -1
    fi
fi

docker exec -it adi_server.1.$(sudo docker service ps adi_server -q --no-trunc | head -n1) npx ts-node tasks/create-user.ts $USERNAME $PASSWORD $APIKEY
